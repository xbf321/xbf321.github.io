<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.0">Jekyll</generator><link href="/feed.xml" rel="self" type="application/atom+xml" /><link href="/" rel="alternate" type="text/html" /><updated>2021-09-19T14:40:06+08:00</updated><id>/feed.xml</id><title type="html">柏放的小屋</title><subtitle>记录工作、生活、学习。</subtitle><entry><title type="html">frp 配置和使用</title><link href="/2017/07/21/how-to-use-frp.html" rel="alternate" type="text/html" title="frp 配置和使用" /><published>2017-07-21T00:00:00+08:00</published><updated>2017-07-21T00:00:00+08:00</updated><id>/2017/07/21/how-to-use-frp</id><content type="html" xml:base="/2017/07/21/how-to-use-frp.html">&lt;h2 id=&quot;frp-作用&quot;&gt;frp 作用&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;利用处于内网或防火墙后的机器，对外网环境提供 http 或 https 服务。&lt;/li&gt;
  &lt;li&gt;对于 http, https 服务支持基于域名的虚拟主机，支持自定义域名绑定，使多个域名可以共用一个80端口。&lt;/li&gt;
  &lt;li&gt;利用处于内网或防火墙后的机器，对外网环境提供 tcp 和 udp 服务，例如在家里通过 ssh 访问处于公司内网环境内的主机。&lt;/li&gt;
&lt;/ul&gt;

&lt;!--more--&gt;

&lt;p&gt;详细参见&lt;a href=&quot;https://github.com/fatedier/frp/blob/master/README_zh.md&quot;&gt;官网&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;服务端配置公网&quot;&gt;服务端配置（公网）&lt;/h2&gt;

&lt;h3 id=&quot;下载&quot;&gt;下载&lt;/h3&gt;

&lt;p&gt;使用 &lt;strong&gt;wget&lt;/strong&gt; 指令下载到我们制定的目录中，如：&lt;em&gt;/home/tools/frp&lt;/em&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo wget https://github.com/fatedier/frp/releases/download/v0.13.0/frp_0.13.0_linux_amd64.tar.gz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;解压&quot;&gt;解压&lt;/h3&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo tar -zxvf frp_0.13.0_linux_amd64.tar.gz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;因为作为服务端，可以把客户端文件删掉，使用 &lt;em&gt;rm&lt;/em&gt; 指令。&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo rm -f frpc
sudo rm -f frpc.ini
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;编辑-frpsini-配置文件&quot;&gt;编辑 &lt;em&gt;frps.ini&lt;/em&gt; 配置文件&lt;/h3&gt;

&lt;p&gt;可以参考官网范例。
我这删掉了一些不用的内容，是个简化版的配置文件。&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[common]
bind_port = 7000
vhost_http_port = 80
dashboard_port = 7500
dashboard_user = xxx
dashboard_pwd = xxx
log_file = /home/tools/frp/frps.log
subdomain_host = xxx.me

[ssh]
listen_port = 422
auth_token = xxx

[nas]
type = http
auth_token = xxx

[nas-rpc]
type = http
auth_token = xxx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;启动服务&quot;&gt;启动服务&lt;/h3&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;./frps -c ./frps.ini
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;systemd-管理&quot;&gt;Systemd 管理&lt;/h3&gt;

&lt;p&gt;因为我的公网机器是 Centos ，所以用的是 Systemd 管理。&lt;/p&gt;

&lt;p&gt;编写 &lt;em&gt;frp service&lt;/em&gt; 文件&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo vim /usr/lib/systemd/system/frps.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;内容如下：&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[Unit]
Description=frps
After=network.target

[Service]
TimeoutStartSec=30
ExecStart=/home/tools/frp/frps -c /home/tools/frp/frps.ini
ExecStop=/bin/kill $MAINPID

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;开机启动和查看状态&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;systemctl enable frps
systemctl start frps
systemctl status frps

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;客户端配置内网&quot;&gt;客户端配置（内网）&lt;/h2&gt;

&lt;p&gt;因为 frp 下载自带客户端和服务端，所以这里，可以参考上面的。&lt;/p&gt;

&lt;p&gt;下载之后，同样删掉 &lt;strong&gt;服务端&lt;/strong&gt; 文件。&lt;/p&gt;

&lt;h3 id=&quot;编辑-fprcini-配置文件&quot;&gt;编辑 &lt;em&gt;fprc.ini&lt;/em&gt; 配置文件&lt;/h3&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[common]
server_addr = 1.1.1.1
server_port = 7000
log_file = /home/q/tools/frp/frpc.log
auth_token = xxx

[ssh]
type = tcp
local_ip = 127.0.0.1
local_port = 22
remote_port = 422

[nas]
type = http
local_ip = 127.0.0.1
local_port = 8888
subdomain = nas

[nas-rpc]
type = http
local_ip = 127.0.0.1
local_port = 6800
subdomain = rpc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;blockquote&gt;
  &lt;p&gt;客户端和服务器端要一一对应，比如 [xxx]&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;启动服务-1&quot;&gt;启动服务&lt;/h3&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;./frpc -c ./frpc.ini
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;后台运行&quot;&gt;后台运行&lt;/h3&gt;

&lt;p&gt;服务端虽然启动了，但是不能就这么算了。这个进程最好可以向Windows服务那样拥有一个状态，可以开机自启。我们使用Linux下常用的进程管理器supervisor来管理该服务。&lt;/p&gt;

&lt;p&gt;首先需要安装supervisor。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-get install supervisor
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;然后在/etc/supervisor/conf.d下新建一个配置文件frp.conf，输入以下内容。command应该是你放置frp软件的位置。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[program:frp]
command = /home/q/tools/frp/frpc -c /home/q/tools/frp/frpc.ini
autostart = true
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;然后启动supervisor，如果事先已经安装好了supervisor那么就重新启动。之后查看一下supervisor的运行状态，看看frp是否已在运行。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# 重启supervisor
sudo systemctl restart supervisor
# 查看supervisor运行状态
sudo supervisorctl status
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name></name></author><summary type="html">frp 作用 利用处于内网或防火墙后的机器，对外网环境提供 http 或 https 服务。 对于 http, https 服务支持基于域名的虚拟主机，支持自定义域名绑定，使多个域名可以共用一个80端口。 利用处于内网或防火墙后的机器，对外网环境提供 tcp 和 udp 服务，例如在家里通过 ssh 访问处于公司内网环境内的主机。</summary></entry><entry><title type="html">在Mac中安装nginx</title><link href="/2015/08/12/install-nginx-in-mac.html" rel="alternate" type="text/html" title="在Mac中安装nginx" /><published>2015-08-12T00:00:00+08:00</published><updated>2015-08-12T00:00:00+08:00</updated><id>/2015/08/12/install-nginx-in-mac</id><content type="html" xml:base="/2015/08/12/install-nginx-in-mac.html">&lt;p&gt;homebrew是mac下非常好用的包管理器，会自动安装相关的依赖包，将你从繁琐的软件依赖安装中解放出来。&lt;/p&gt;

&lt;!--more--&gt;

&lt;h2 id=&quot;安装homebrew&quot;&gt;安装Homebrew&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;homebrew是mac下非常好用的包管理器，会自动安装相关的依赖包，将你从繁琐的软件依赖安装中解放出来。
安装homebrew也非常简单，只要在终端中输入:&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;安装-nginx&quot;&gt;安装 Nginx&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;安装时，会首先安装依赖&lt;strong&gt;pcre&lt;/strong&gt;和&lt;strong&gt;openssl&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;brew install nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;启动-nginx&quot;&gt;启动 Nginx&lt;/h2&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;测试&quot;&gt;测试&lt;/h2&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://localhost:8080
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;配置nginxconf&quot;&gt;配置nginx.conf&lt;/h2&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo nginx -s stop
vim /usr/local/etc/nginx/nginx.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;保存并启动&quot;&gt;保存并启动&lt;/h2&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name></name></author><summary type="html">homebrew是mac下非常好用的包管理器，会自动安装相关的依赖包，将你从繁琐的软件依赖安装中解放出来。</summary></entry></feed>